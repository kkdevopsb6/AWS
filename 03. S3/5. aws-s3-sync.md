# AWS S3 sync command in depth

## 1. What aws s3 sync actually does

aws s3 sync synchronizes a local directory and an S3 prefix, or two S3 prefixes. It recursively copies new and updated files from source to destination. It creates “folders” on the destination only when there is at least one object under that prefix. ([AWS Documentation][1])

Common sync directions

* Local to S3
  aws s3 sync ./site s3://my-bucket/site/
* S3 to local
  aws s3 sync s3://my-bucket/site/ ./site
* S3 to S3
  aws s3 sync s3://source-bucket/prefix/ s3://dest-bucket/prefix/

## 2. How sync decides what to copy

Default comparison logic is based on file size and last modified time. Sync tries to avoid re-uploading objects that appear unchanged.

Important options that change comparison

* --size-only
  Sync uses only size to decide whether to copy. ([awscli.amazonaws.com][2])
* --exact-timestamps
  This matters when syncing from S3 to local. For same-sized items, the file is ignored only when timestamps match exactly. Default behavior ignores same-sized items unless local is newer than S3. ([awscli.amazonaws.com][2])

Practical note

* --exact-timestamps is primarily for S3 to local comparisons, not for local to S3 behavior. If you use it for uploads, do not expect it to behave the same way as download sync. ([awscli.amazonaws.com][2])

## 3. The most used flags and what they really mean

### --delete

Deletes files in the destination that do not exist in the source. This is how you make destination a mirror of source. ([awscli.amazonaws.com][2])

Examples

* Mirror local folder into S3

```bash
aws s3 sync ./backup s3://my-bucket/backup/ --delete
```

Risk

* If you point to the wrong destination prefix, it can delete large amounts of data. Always dry run first.

### --dryrun

Shows what would happen without actually copying or deleting.

```bash
aws s3 sync ./site s3://my-bucket/site/ --delete --dryrun
```

### --exclude and --include

These control which files are considered. Exclude rules are evaluated first, then include can re-allow specific patterns.

Common patterns

* Exclude everything, then include only what you want

```bash
aws s3 sync ./build s3://my-bucket/app/ --exclude "*" --include "*.html" --include "assets/*"
```

### --storage-class

Sets storage class for uploaded objects during local to S3 sync.

```bash
aws s3 sync ./logs s3://my-bucket/logs/ --storage-class STANDARD_IA
```

This option is part of the sync command reference. ([AWS Documentation][1])

### Encryption flags

You can request server-side encryption settings while uploading.

* --sse supports AES256 or aws:kms in AWS CLI docs. ([AWS Documentation][3])
  Example

```bash
aws s3 sync ./data s3://my-bucket/data/ --sse AES256
```

If you use SSE-KMS, you usually also need the correct KMS permissions on the IAM principal doing the sync.

Amazon S3 encrypts new objects by default with SSE-S3 (bucket default encryption behavior), but explicit flags are still useful when you want to enforce behavior from the client side. ([AWS Documentation][4])

### --acl

You can set an ACL like private, public-read, bucket-owner-full-control depending on your scenario. In most production setups, prefer bucket policies and “bucket owner enforced” ownership settings rather than heavy ACL usage.

## 4. Real world use cases with correct commands

### Use case A: Deploy static website files to S3

```bash
aws s3 sync ./website s3://my-bucket/ --delete
```

Why --delete

* Removes old files from previous deploys so users do not load stale JS or CSS.

### Use case B: Backup server directory to S3 daily

```bash
aws s3 sync /var/backups s3://my-bucket/server1/backups/ --storage-class STANDARD_IA
```

### Use case C: Pull logs from S3 for troubleshooting

```bash
aws s3 sync s3://my-bucket/app-logs/ ./app-logs --exact-timestamps
```

Exact timestamps is mainly valuable in S3 to local direction. ([awscli.amazonaws.com][2])

### Use case D: Sync between two buckets (migration)

```bash
aws s3 sync s3://old-bucket/data/ s3://new-bucket/data/
```

For very large migrations, also consider S3 Batch Operations or DataSync, but sync is fine for many cases.

## 5. Performance behavior you should know

* Sync is recursive and transfers many files in parallel.
* For large objects, AWS S3 supports multipart upload, which uploads a single object as parts and improves reliability. Many AWS clients use multipart automatically above a threshold. ([AWS Documentation][5])

If you observe slow performance

* Reduce tiny-file counts by packaging where sensible
* Avoid syncing huge directories when only a small subset changes, use prefix layout and filters

## 6. Common mistakes and how to avoid them

### Mistake 1: Using --delete without dry run

Safe pattern

```bash
aws s3 sync ./src s3://my-bucket/dst/ --delete --dryrun
aws s3 sync ./src s3://my-bucket/dst/ --delete
```

### Mistake 2: Wrong prefix or missing trailing slash expectations

S3 is key-based. Be consistent with prefixes like s3://bucket/app/ to keep objects under app/.

### Mistake 3: Expecting sync to remove old object versions

--delete removes keys from the destination, but if bucket versioning is enabled, it creates delete markers, not immediate permanent deletion.

### Mistake 4: Timestamps confusion on Windows or between filesystems

If timestamps shift due to filesystem behavior or timezone conversions, sync may re-copy more than expected. In such environments, consider --size-only. ([awscli.amazonaws.com][2])

### Mistake 5: SSE-KMS replication or access issues

If uploads fail with access denied, it is often missing KMS permissions, not S3 permissions.

## 7. Minimum IAM permissions for s3 sync

For local to S3 sync, typical minimum is:

* s3:ListBucket on bucket
* s3:PutObject on destination prefix
* s3:GetObject and s3:HeadObject may be needed for comparisons
* s3:DeleteObject if you use --delete

For S3 to local:

* s3:ListBucket
* s3:GetObject

Exact policies depend on your bucket prefix and encryption model.

## 8. Quick difference: aws s3 cp vs aws s3 sync

* cp copies files even if already present unless you manage logic yourself
* sync compares and only transfers what changed, and can optionally delete destination extras (mirror behavior) ([AWS Documentation][1])

